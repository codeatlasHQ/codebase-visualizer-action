# action.yml
name: 'Codeatlas - Codebase Visualisation'
description: ''
inputs:
  sub_directory:
    description: 'Sub-directory to start visualisation from.'
    required: false
    default: ''
  output_path:
    required: false
    default: '.codeatlas'
  output_json_filename:
    required: false
    default: 'codeatlas_cells.json'
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3

    - name: pull
      shell: bash
      run: docker pull ghcr.io/codeatlashq/codebase-tessellator:0.1.0-rc.2
    
    - name: print pwd
      shell: bash
      run: pwd

    - name: ls pwd
      shell: bash
      run: ls

    - name: list workspace
      shell: bash
      run: ls /home/runner/work/flask/flask

    - name: 'Codeatlas - Codebase Visualisation'
      shell: bash
      run: docker run --mount type=bind,source="$GITHUB_WORKSPACE",target=$GITHUB_WORKSPACE ghcr.io/codeatlashq/codebase-tessellator:0.1.0-rc.2 tessellate-from-path --repo_path $GITHUB_WORKSPACE/${{ inputs.sub_directory }} --output_path $GITHUB_WORKSPACE/${{ inputs.output_path }}

    - uses: EndBug/add-and-commit@v9 # You can change this to use a specific version.
      with:
        # The arguments for the `git add` command (see the paragraph below for more info)
        # Default: '.'
        add: "./${{ inputs.output_path }}/"

        # The name of the user that will be displayed as the author of the commit.
        # Default: depends on the default_author input
        author_name: codeatlas-bot

        # The email of the user that will be displayed as the author of the commit.
        # Default: depends on the default_author input
        author_email: hello@codeatlas.dev

        # If this input is set, the action will push the commit to a new branch with this name.
        # Default: ''
        new_branch: codeatlas

        push: true


